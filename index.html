<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡éƒ½äº‘å›¾ï¼šå—äº¬ç°å½“ä»£æ–‡å­¦åœ°å›¾æ•°å­—å¯¼è§ˆä¸æ–‡åˆ›å¹³å°</title>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/ai_assistant.css"> 
    <script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.4.2/echarts.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <style>
       .explore-btn-container {
            text-align: center;
            padding: 40px 0; 
            margin-top: 20px;
            background: linear-gradient(135deg, #1a5fad, #2a8fe6, #c2e5ff);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255,255,255,0.1) 20%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(255,255,255,0.1) 15%, transparent 30%);
            box-shadow: 0 4px 15px rgba(0, 100, 200, 0.3); 
        }

        .explore-btn {
            background: linear-gradient(to right, #2a6fc7, #4a9df7);
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3); 
            transition: all 0.3s; 
            font-size: 1.6rem;
        }
        .explore-btn:hover {
            background: linear-gradient(to right, #1a5fad, #3a8de0); 
            transform: translateY(-2px); 
        }
                
                @media (max-width: 768px) {
                    .explore-btn {
                        padding: 12px 30px;
                        font-size: 1.4rem;
                    }
                }
    </style>
</head>
<body>
    <div class="header">
        <h1>æ¢ç´¢ä½œå®¶ç¬”ä¸‹çš„äººæ–‡å—äº¬</h1>
        <p>æ–‡éƒ½äº‘å›¾ï¼šå—äº¬ç°å½“ä»£æ–‡å­¦åœ°å›¾æ•°å­—å¯¼è§ˆä¸æ–‡åˆ›å¹³å°</p>
    </div>
    
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="è¯·è¾“å…¥ä½œå®¶å§“å(å¦‚:å¶å…†è¨€ã€æœ±è‡ªæ¸…...)">
        <button id="searchBtn">æœç´¢</button>
    </div>
    
    <div class="container">
        <div id="mapContainer"></div>
        
        <div class="sidebar">
            <div id="infoPanel">
                <div class="default-message">
                    <h3>æ¬¢è¿ä½¿ç”¨å—äº¬ç°å½“ä»£æ–‡å­¦åœ°å›¾æ•°å­—å¯¼è§ˆä¸æ–‡åˆ›å¹³å°</h3>
                    <p>åœ¨æœç´¢æ¡†ä¸­è¾“å…¥ä½œå®¶å§“åï¼ŒæŸ¥çœ‹ä»–ä»¬åœ¨å—äº¬çš„åˆ›ä½œè¶³è¿¹</p>
                    <p>ç‚¹å‡»åœ°å›¾ä¸Šçš„æ ‡è®°ç‚¹ï¼ŒæŸ¥çœ‹ä½œå“è¯¦æƒ…</p>
                    <p>å·²æ”¶å½•23ä½ä½œå®¶ï¼Œ147éƒ¨å—äº¬ç›¸å…³ä½œå“</p>
                </div>
            </div>
            
            <div id="counter">
                <div class="counter-label">å½“å‰å±•ç¤ºä½œå“</div>
                <div class="counter-number">0</div>
                <div class="counter-label">éƒ¨æ–‡å­¦ä½œå“</div>
            </div>
        </div>
    </div>
    
    <!-- AIåŠ©æ‰‹å®¹å™¨ä¿æŒä¸å˜ -->
    <div id="ai-assistant">
        <div id="chat-container">
            <div class="chat-header">
                <h3>å—äº¬æ–‡å­¦åŠ©æ‰‹</h3>
                <button id="close-chat">Ã—</button>
            </div>
            <div id="chat-messages"></div>
            <div class="chat-input">
                <input type="text" id="user-input" placeholder="è¾“å…¥å…³äºå—äº¬ç°å½“ä»£æ–‡å­¦çš„é—®é¢˜...">
                <button id="send-btn">å‘é€</button>
            </div>
        </div>
        <button id="chat-toggle">ğŸ’¬</button>
    </div>
    
    
    <div class="explore-btn-container">
        <a href="./html/product.html" class="explore-btn">
            æ–‡éƒ½äº‘å›¾
        </a>
    </div>
    
    <script src="./js/script.js"></script>
    <script src="./js/ai_assistant.js"></script> 
    
    <script>
        // åœ°å›¾åˆå§‹åŒ–ä»£ç 
        $(document).ready(function() {
            const myChart = echarts.init(document.getElementById('mapContainer'));
            
            // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            myChart.showLoading({
                text: 'æ­£åœ¨åŠ è½½å—äº¬åœ°å›¾æ•°æ®...',
                color: '#4a6cf7',
                textColor: '#4a5568',
                maskColor: 'rgba(255, 255, 255, 0.9)'
            });
            
            // ä½¿ç”¨æœ¬åœ°åœ°å›¾æ•°æ®
            fetch('./data/nanjing.json')
                .then(response => response.json())
                .then(nanjingGeoJSON => {
                    // æ³¨å†Œå—äº¬åœ°å›¾
                    echarts.registerMap('nanjing', nanjingGeoJSON);
                    
                    // é…ç½®åœ°å›¾é€‰é¡¹
                    const option = {
                        title: {
                            text: 'å—äº¬æ–‡å­¦åœ°å›¾',
                            subtext: 'ä½œå®¶ç¬”ä¸‹çš„äººæ–‡å—äº¬',
                            left: 'center',
                            textStyle: { 
                                color: '#2d3748', 
                                fontSize: 24,
                                fontWeight: 'bold'
                            },
                            subtextStyle: { 
                                color: '#718096',
                                fontSize: 16
                            }
                        },
                        tooltip: {
                            trigger: 'item',
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            borderColor: '#e2e8f0',
                            borderWidth: 1,
                            padding: 15,
                            borderRadius: 8,
                            textStyle: {
                                color: '#2d3748'
                            },
                            formatter: function(params) {
                                if (params.componentType === 'series') {
                                    return `<div style="font-weight:bold;margin-bottom:5px;">${params.name}</div>
                                            <div>${params.data.excerpt || 'å—äº¬æ–‡å­¦åœ°æ ‡'}</div>
                                            <div style="margin-top:8px;color:#4a5568;">ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…</div>`;
                                }
                                return params.name;
                            }
                        },
                        geo: {
                            map: 'nanjing',
                            roam: true,
                            zoom: 8,
                            center: [118.8, 32.05],
                            label: { 
                                emphasis: { 
                                    show: false 
                                } 
                            },
                            itemStyle: {
                                areaColor: '#e8f4ff',
                                borderColor: '#297acc'
                            },
                            emphasis: {
                                itemStyle: { 
                                    areaColor: '#a4d0ff' 
                                },
                                label: { 
                                    show: true, 
                                    color: '#1a3d66' 
                                }
                            }
                        },
                        series: [{
                            name: 'æ–‡å­¦åœ°æ ‡',
                            type: 'scatter',
                            coordinateSystem: 'geo',
                            symbol: 'pin',
                            symbolSize: [40, 50],
                            itemStyle: { 
                                color: '#ff6b6b' 
                            },
                            data: [
                                {name: "å¤«å­åº™", value: [118.79, 32.02], excerpt: "æœ±è‡ªæ¸…ã€Šæ¡¨å£°ç¯å½±é‡Œçš„ç§¦æ·®æ²³ã€‹åˆ›ä½œåœ°"},
                                {name: "ä¸­å±±é™µ", value: [118.85, 32.06], excerpt: "å¶å…†è¨€ã€Šå—äº¬ä¼ ã€‹ä¸­é‡è¦å†å²åœ°æ ‡"},
                                {name: "å—äº¬å¤§å­¦", value: [118.78, 32.06], excerpt: "ä¼—å¤šä½œå®¶ä»»æ•™æˆ–æ±‚å­¦ä¹‹åœ°"},
                                {name: "ç„æ­¦æ¹–", value: [118.80, 32.07], excerpt: "å¼ æ¨æ°´å°è¯´ä¸­çš„ç»å…¸åœºæ™¯"},
                                {name: "æµ¦å£ç«è½¦ç«™", value: [118.74, 32.15], excerpt: "æœ±è‡ªæ¸…ã€ŠèƒŒå½±ã€‹å‘ç”Ÿåœ°"}
                            ],
                            label: {
                                show: true,
                                formatter: '{b}',
                                position: 'bottom',
                                color: '#1a3d66',
                                fontSize: 12
                            },
                            zlevel: 2
                        }]
                    };
                    
                    // åº”ç”¨é…ç½®
                    myChart.setOption(option);
                    
                    // éšè—åŠ è½½åŠ¨ç”»
                    myChart.hideLoading();
                    
                    // æ›´æ–°è®¡æ•°å™¨
                    $('.counter-number').text(option.series[0].data.length);
                    
                    // åœ°å›¾ç‚¹å‡»äº‹ä»¶
                    myChart.on('click', function(params) {
                        if (params.componentType === 'series') {
                            const content = `
                                <div class="location-detail">
                                    <h3>${params.name}</h3>
                                    <p>${params.data.excerpt}</p>
                                    <div class="literary-works">
                                        <h4>ç›¸å…³ä½œå“:</h4>
                                        <ul>
                                            <li>æœ±è‡ªæ¸…ã€Šæ¡¨å£°ç¯å½±é‡Œçš„ç§¦æ·®æ²³ã€‹</li>
                                            <li>å¶å…†è¨€ã€Šå—äº¬ä¼ ã€‹</li>
                                            <li>å¼ æ¨æ°´ã€Šç§¦æ·®ä¸–å®¶ã€‹</li>
                                        </ul>
                                    </div>
                                </div>
                            `;
                            
                            $('#infoPanel').html(content);
                        }
                    });
                })
                .catch(error => {
                    console.error('åŠ è½½å—äº¬åœ°å›¾æ•°æ®å¤±è´¥:', error);
                    myChart.hideLoading();
                    myChart.setOption({
                        title: {
                            text: 'æ•°æ®åŠ è½½å¤±è´¥',
                            subtext: 'è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åå†è¯•',
                            left: 'center',
                            top: 'center'
                        }
                    });
                });
            
            // å“åº”çª—å£å¤§å°å˜åŒ–
            window.addEventListener('resize', function() {
                myChart.resize();
            });
            
            // æœç´¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            $('#searchBtn').click(function() {
                const query = $('#searchInput').val().trim();
                if (!query) return;
                
                // æ¨¡æ‹Ÿæœç´¢æ•ˆæœ - é«˜äº®ç›¸å…³åŒºåŸŸ
                const area = query.includes('ç§¦æ·®') ? 'é¼“æ¥¼åŒº' : 
                            query.includes('ä¸­å±±') ? 'ç„æ­¦åŒº' : null;
                
                if (area) {
                    myChart.dispatchAction({
                        type: 'highlight',
                        name: area
                    });
                    
                    // æ›´æ–°ä¿¡æ¯é¢æ¿
                    const authors = {
                        'å¶å…†è¨€': 'å—äº¬ä½œå®¶ï¼Œä»£è¡¨ä½œã€Šå—äº¬ä¼ ã€‹',
                        'æœ±è‡ªæ¸…': 'ç°ä»£æ•£æ–‡å®¶ï¼Œã€Šæ¡¨å£°ç¯å½±é‡Œçš„ç§¦æ·®æ²³ã€‹ä½œè€…',
                        'å¼ æ¨æ°´': 'æ°‘å›½æ—¶æœŸè‘—åå°è¯´å®¶ï¼Œã€Šç§¦æ·®ä¸–å®¶ã€‹ä½œè€…'
                    };
                    
                    const authorInfo = authors[query] || `æœªæ‰¾åˆ°${query}çš„è¯¦ç»†ä¿¡æ¯`;
                    
                    $('#infoPanel').html(`
                        <div class="author-info">
                            <h3>${query}</h3>
                            <p>${authorInfo}</p>
                            <div class="related-locations">
                                <h4>ç›¸å…³åœ°ç‚¹:</h4>
                                <ul>
                                    <li>å¤«å­åº™</li>
                                    <li>ä¸­å±±é™µ</li>
                                    <li>ç„æ­¦æ¹–</li>
                                </ul>
                            </div>
                        </div>
                    `);
                }
            });
        });
    </script>
</body>
</html>